<root main_tree_to_execute="MainTree">


    <BehaviorTree ID="MainTree">
        <Sequence>
            <!-- Detect assembly mesh -->
            <!-- <DetectFrame 
                source_frame="assembly_base_link"
                target_frame="world"
                output_pose="{mesh_pose}"
                timeout="3.0"
            /> -->

            <AddCollisionMeshService 
                service_name="apply_planning_scene"
                mesh_path="package://homestri_description/meshes/components/collision/robinzen_static_assembly.stl"
                pose="0.91;0;0.915;0;0;0"
                mesh_pose="0;0;0;0;0;0"
                id="robinzen_static_assembly"
                frame_id="world"
            />

            <AddCollisionMeshService 
                service_name="apply_planning_scene"
                mesh_path="package://homestri_description/meshes/components/collision/robinzen_moving_assembly.stl"
                pose="0.91;0;0.915;0;0;0"
                mesh_pose="0;0;0;0;0;0"
                id="robinzen_moving_assembly"
                frame_id="world"
            />

            <AddCollisionMeshService 
                service_name="apply_planning_scene"
                mesh_path="package://homestri_description/meshes/components/collision/robinzen_table.stl"
                pose="0.91;0;0.915;0;0;0"
                mesh_pose="0;0;0;0;0;0"
                id="robinzen_table"
                frame_id="world"
            />

            <ManipulationAction
                server_name="manip_as"
                id="arm_pose"
                pose="0.5;0.078;1.28;0;0;0;1"
                translational_offset="0;0;0"
            /> 

            <!-- <DetectFrame 
                source_frame="handle_target"
                target_frame="world"
                output_pose="{handle_pose}"
                timeout="3.0"
            /> -->


            <ManipulationAction
                server_name="manip_as"
                id="arm_pose"
                pose="0.912;0.06;1.28;0;0;0.4"
                translational_offset="-0.15;0;0"
            /> 

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0"
                max_effort="20"
            /> 

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="forward_cartesian_traj_controller"
            />


            <CartesianControlAction
                server_name="cartesian_control"
                offset="0.15;0;0;0;0;0"
                duration="10.0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            <TriggerService
                service_name="/ur_hardware_interface/zero_ftsensor"
            />

            <!-- <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="cartesian_compliance_controller"
            /> -->

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="cartesian_force_controller"
            />

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0.8"
                max_effort="20"
            /> 

            <!-- <ComplianceControlAction
                server_name="compliance_control"
                offset="-0.3;0;0;0;0;0"
                wrench="-75;0;0;0;0;0"
                frame_id="world"
                mode="offset"
            />    -->

            <ForceControlAction
                server_name="force_control"
                wrench="-40;0;0;0;0;0"
                frame_id="world"
            /> 



            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="forward_cartesian_traj_controller"
            />

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0"
                max_effort="20"
            /> 

            <CartesianControlAction
                server_name="cartesian_control"
                offset="-0.1;0;0;0;0;0"
                duration="10.0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            <CartesianControlAction
                server_name="cartesian_control"
                offset="0.1;0;0;0;0;0"
                duration="10.0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            
            


            <TriggerService
                service_name="/ur_hardware_interface/zero_ftsensor"
            />

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="cartesian_compliance_controller"
            />

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0.8"
                max_effort="20"
            /> 

            <ComplianceControlAction
                server_name="compliance_control"
                offset="0.3;0;0;0;0;0"
                wrench="50;0;0;0;0;0"
                frame_id="world"
                mode="offset"
            />   


            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="forward_cartesian_traj_controller"
            />

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0"
                max_effort="20"
            /> 

            

            <CartesianControlAction
                server_name="cartesian_control"
                offset="-0.1;0;0;0;0;0"
                duration="10.0"
                frame_id="gripper_tip_link"
                mode="offset"
            /> 


            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                controller="scaled_pos_joint_traj_controller"
            />  

















































            

            <!-- <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0"
                max_effort="20"
            /> 

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                start_controllers="forward_cartesian_traj_controller"
                stop_controllers="scaled_pos_joint_traj_controller"
                strictness="2"
            />


            <CartesianControlAction
                server_name="cartesian_control"
                offset="0.1;0;0;0;0;0"
                duration="10.0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            <TriggerService
                service_name="/ur_hardware_interface/zero_ftsensor"
            />

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                start_controllers="cartesian_compliance_controller"
                stop_controllers="forward_cartesian_traj_controller"
                strictness="2"
            />

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0.8"
                max_effort="20"
            /> 

            <ComplianceControlAction
                server_name="compliance_control"
                offset="0;0;0;-1.5707;0;0"
                wrench="0;0;0;-3;0;0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            <GripperAction
                server_name="gripper_controller/gripper_cmd"
                position="0"
                max_effort="20"
            /> 

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                start_controllers="forward_cartesian_traj_controller"
                stop_controllers="cartesian_compliance_controller"
                strictness="2"
            />

            <CartesianControlAction
                server_name="cartesian_control"
                offset="-0.1;0;0;0;0;0"
                duration="10.0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            <CartesianControlAction
                server_name="cartesian_control"
                offset="0;0;0;1.5707;0;0"
                duration="5.0"
                frame_id="gripper_tip_link"
                mode="offset"
            />   

            <SwitchControllerService
                service_name="controller_manager/switch_controller"
                start_controllers="scaled_pos_joint_traj_controller"
                stop_controllers="forward_cartesian_traj_controller"
                strictness="2"
            /> --> 

            <!-- <DetectFrame 
                source_frame="latch_0_open"
                target_frame="world"
                output_pose="{object_pose}"
                timeout="3.0"
                r_x="1.0"
                r_y="0.0"
                r_z="0.0"
                r_w="0.0"
            />

            <ManipulationAction
                server_name="manip_as"
                id="arm_pose"
                pose="{object_pose}"
                translational_offset="-0.1;0;0"
            />  -->


            <!-- <ManipulationAction
                name="close gripper and grasp"
                server_name="manip_as"
                id="gripper_close"
            />      -->
        </Sequence>

    </BehaviorTree>

</root>